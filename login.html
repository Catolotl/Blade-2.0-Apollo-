<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blade Card ‚Äî JVST</title>
  <link rel="shortcut icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400;1,600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#000;--bg2:#0c0c0c;--bg3:#141414;--bg4:#1c1c1c;--b:#242424;--b2:#333;--t:#fff;--t2:#999;--t3:#555;--red:#ff2d2d;--red0:rgba(255,45,45,.10);--red1:rgba(255,45,45,.22);--yellow:#f5c842;--green:#34c759;--blue:#0a84ff}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
body{font-family:'JetBrains Mono','Inter',monospace;background:var(--bg);color:var(--t);min-height:100vh;overflow-x:hidden;letter-spacing:-.01em}
a{color:inherit;text-decoration:none}
img{display:block}
button,input,textarea,select{font-family:inherit}
button{cursor:pointer}
input,textarea{cursor:text}

body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:.028;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");background-size:200px 200px}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;z-index:300;background:rgba(0,0,0,.92);backdrop-filter:blur(18px);border-bottom:1px solid var(--b);height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 28px}
.nav-logo{font-size:1.15rem;font-weight:700;letter-spacing:-.02em;cursor:pointer;transition:opacity .15s}
.nav-logo:hover{opacity:.8}
.nav-logo span{color:var(--red)}
.nav-right{display:flex;align-items:center;gap:10px}
.nav-btn{padding:7px 16px;border-radius:6px;font-size:.82rem;font-weight:600;border:1px solid var(--b2);background:transparent;color:var(--t2);transition:all .15s}
.nav-btn:hover{border-color:var(--t);color:var(--t)}
.nav-btn.primary{background:var(--red);color:#fff;border-color:var(--red)}
.nav-btn.primary:hover{opacity:.88}

/* SCREENS */
.screen{display:none;min-height:100vh;padding-top:60px}
.screen.active{display:block}

/* PULSE */
.pulse-dot{width:7px;height:7px;border-radius:50%;background:var(--red);display:inline-block;animation:pdot 2s ease-out infinite}
@keyframes pdot{0%{box-shadow:0 0 0 0 rgba(255,45,45,.7)}70%{box-shadow:0 0 0 8px rgba(255,45,45,0)}100%{box-shadow:0 0 0 0 rgba(255,45,45,0)}}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:11px 22px;border-radius:7px;font-size:.875rem;font-weight:600;border:none;transition:all .15s;white-space:nowrap}
.btn-red{background:var(--red);color:#fff}.btn-red:hover{opacity:.88}
.btn-ghost{background:transparent;color:var(--t);border:1px solid var(--b2)}.btn-ghost:hover{border-color:var(--t)}
.btn-yellow{background:var(--yellow);color:#000;font-style:italic;font-weight:700}.btn-yellow:hover{opacity:.9}
.btn-sm{padding:7px 14px;font-size:.8rem;border-radius:6px}
.btn-full{width:100%}
.btn:disabled{opacity:.45;pointer-events:none}

/* FORMS */
.fg{margin-bottom:18px}
.fg label{display:block;font-size:.7rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--t3);margin-bottom:7px}
.fg input,.fg select{width:100%;padding:11px 14px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.88rem;outline:none;transition:border-color .2s}
.fg input:focus,.fg select:focus{border-color:var(--red)}
.fg input::placeholder{color:var(--t3)}
.form-error{font-size:.78rem;color:var(--red);min-height:16px;margin-top:4px}

/* LANDING */
.landing-hero{min-height:calc(100vh - 60px);display:flex;align-items:center;justify-content:center;padding:80px 28px;position:relative;overflow:hidden}
.landing-glow{position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);width:700px;height:500px;background:radial-gradient(ellipse,rgba(255,45,45,.05) 0%,transparent 65%);pointer-events:none}
.landing-inner{max-width:580px;width:100%;text-align:center}
.landing-badge{display:inline-flex;align-items:center;gap:8px;padding:5px 14px;background:var(--red0);border:1px solid var(--red1);border-radius:4px;font-size:.67rem;font-weight:700;letter-spacing:.13em;text-transform:uppercase;color:var(--red);margin-bottom:28px}
.landing-title{font-size:clamp(2.4rem,6vw,4rem);font-weight:800;letter-spacing:-.05em;line-height:1.0;margin-bottom:20px}
.hl{background:var(--yellow);color:#000;font-style:italic;padding:1px 6px;border-radius:3px}
.hl-red{background:var(--red);color:#fff;font-style:italic;padding:1px 6px;border-radius:3px}
.landing-sub{font-size:.95rem;color:var(--t2);line-height:1.7;margin-bottom:36px;max-width:420px;margin-left:auto;margin-right:auto}
.landing-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:56px}
.landing-features{display:grid;grid-template-columns:1fr 1fr;gap:10px;text-align:left}
.lf-card{background:var(--bg2);border:1px solid var(--b);border-radius:10px;padding:20px;transition:border-color .2s,transform .18s;position:relative;overflow:hidden}
.lf-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--red);transform:scaleY(0);transform-origin:bottom;transition:transform .3s}
.lf-card:hover{border-color:var(--b2);transform:translateY(-2px)}.lf-card:hover::before{transform:scaleY(1)}
.lf-icon{font-size:1.3rem;margin-bottom:9px}
.lf-title{font-size:.875rem;font-weight:600;margin-bottom:4px}
.lf-desc{font-size:.78rem;color:var(--t2);line-height:1.5}

/* AUTH */
.auth-section{min-height:calc(100vh - 60px);display:flex;align-items:center;justify-content:center;padding:60px 24px}
.auth-box{background:var(--bg2);border:1px solid var(--b);border-radius:14px;width:100%;max-width:450px;overflow:hidden;box-shadow:0 24px 60px rgba(0,0,0,.5)}
.auth-tabs{display:flex;border-bottom:1px solid var(--b)}
.auth-tab{flex:1;padding:15px;font-size:.7rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;background:transparent;border:none;color:var(--t3);transition:all .2s;border-bottom:2px solid transparent}
.auth-tab.active{color:var(--t);background:var(--bg3);border-bottom-color:var(--red)}
.auth-tab:hover:not(.active){color:var(--t2)}
.auth-panel{display:none;padding:32px}
.auth-panel.active{display:block}
.auth-panel-title{font-size:1.35rem;font-weight:700;letter-spacing:-.02em;margin-bottom:5px}
.auth-panel-sub{font-size:.82rem;color:var(--t2);margin-bottom:26px;line-height:1.55}
.pic-upload-row{display:flex;align-items:center;gap:14px;margin-bottom:22px;padding:14px;background:var(--bg3);border:1px solid var(--b);border-radius:8px;cursor:pointer;transition:border-color .2s}
.pic-upload-row:hover{border-color:var(--b2)}
.pic-circle{width:52px;height:52px;border-radius:50%;background:var(--bg4);border:2px dashed var(--b2);display:flex;align-items:center;justify-content:center;font-size:1.3rem;overflow:hidden;flex-shrink:0;transition:border-color .2s}
.pic-upload-row:hover .pic-circle{border-color:var(--red)}
.pic-circle img{width:100%;height:100%;object-fit:cover}
.pic-upload-info{font-size:.78rem;color:var(--t2);line-height:1.6}
.pic-upload-info strong{color:var(--t);display:block;margin-bottom:1px}

/* ONBOARDING */
.onboard-section{min-height:calc(100vh - 60px);display:flex;align-items:center;justify-content:center;padding:60px 24px}
.onboard-box{background:var(--bg2);border:1px solid var(--b);border-radius:14px;width:100%;max-width:440px;padding:44px;text-align:center;box-shadow:0 24px 60px rgba(0,0,0,.5)}
.onboard-emoji{font-size:3rem;margin-bottom:20px}
.onboard-title{font-size:1.6rem;font-weight:800;letter-spacing:-.03em;margin-bottom:8px}
.onboard-sub{font-size:.88rem;color:var(--t2);line-height:1.65;margin-bottom:28px}
.nickname-input{width:100%;padding:16px;background:var(--bg3);border:2px solid var(--b2);border-radius:10px;color:var(--t);font-size:1.15rem;font-weight:600;text-align:center;letter-spacing:.02em;outline:none;transition:border-color .2s;margin-bottom:8px}
.nickname-input:focus{border-color:var(--red)}
.nickname-input::placeholder{color:var(--t3);font-weight:400;font-size:1rem}
.nickname-hint{font-size:.75rem;color:var(--t3);margin-bottom:20px;min-height:18px;transition:color .2s}

/* DASHBOARD */
.dash-layout{min-height:calc(100vh - 60px);display:grid;grid-template-columns:256px 1fr}
.dash-sidebar{background:var(--bg2);border-right:1px solid var(--b);padding:20px 14px;display:flex;flex-direction:column;position:sticky;top:60px;height:calc(100vh - 60px);overflow-y:auto}
.dash-sidebar::-webkit-scrollbar{width:3px}.dash-sidebar::-webkit-scrollbar-thumb{background:var(--b2);border-radius:2px}
.dash-main{min-height:calc(100vh - 60px)}
.dash-content{padding:28px;max-width:900px;display:flex;flex-direction:column;gap:22px}

/* sidebar */
.sb-user{padding:14px;background:var(--bg3);border:1px solid var(--b);border-radius:10px;margin-bottom:14px}
.sb-avatar{width:46px;height:46px;border-radius:50%;background:var(--bg4);border:2px solid var(--b2);display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:700;margin-bottom:10px;overflow:hidden;flex-shrink:0}
.sb-avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.sb-nickname{font-size:.9rem;font-weight:700;letter-spacing:-.01em;margin-bottom:1px}
.sb-handle{font-size:.7rem;color:var(--t3);margin-bottom:7px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tier-badge{display:inline-block;padding:3px 9px;border-radius:3px;font-size:.6rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase}
.tier-badge.free{background:var(--bg4);border:1px solid var(--b2);color:var(--t3)}
.tier-badge.premium{background:var(--red0);border:1px solid var(--red1);color:var(--red)}
.tier-badge.plus{background:rgba(245,200,66,.12);border:1px solid rgba(245,200,66,.3);color:var(--yellow);font-style:italic}
.sb-nav{display:flex;flex-direction:column;gap:2px;flex:1}
.sb-item{display:flex;align-items:center;gap:9px;padding:9px 11px;border-radius:7px;font-size:.81rem;font-weight:500;color:var(--t2);background:transparent;border:none;width:100%;text-align:left;transition:all .15s;cursor:pointer;border-left:2px solid transparent}
.sb-item:hover{background:var(--bg3);color:var(--t)}
.sb-item.active{background:var(--bg3);color:var(--t);border-left-color:var(--red)}
.sb-icon{font-size:.9rem;width:17px;text-align:center;flex-shrink:0}
.sb-divider{height:1px;background:var(--b);margin:8px 0}
.sb-section-label{font-size:.6rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--t3);padding:6px 11px 3px;margin-top:4px}
.sb-danger{color:var(--red)!important}.sb-danger:hover{background:var(--red0)!important}

/* panels */
.panel{display:none}
.panel.active{display:flex;flex-direction:column;gap:22px}

/* dashboard cards */
.dc{background:var(--bg2);border:1px solid var(--b);border-radius:12px;padding:24px;position:relative;overflow:hidden}
.dc-label{font-size:.65rem;font-weight:700;letter-spacing:.13em;text-transform:uppercase;color:var(--red);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.dc-title{font-size:1.05rem;font-weight:700;letter-spacing:-.02em;margin-bottom:6px}
.dc-sub{font-size:.82rem;color:var(--t2);line-height:1.6}
.dc-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:16px}
.dc-grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.dc-grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}

/* BLADE CARD VISUAL */
.blade-card-wrap{perspective:1000px;margin-top:4px}
.blade-card{width:100%;max-width:370px;height:208px;border-radius:18px;padding:24px;position:relative;overflow:hidden;transition:transform .4s cubic-bezier(.2,0,.1,1),box-shadow .4s;border:1px solid rgba(255,255,255,.05)}
.blade-card:hover{transform:rotateY(-6deg) rotateX(2deg) translateZ(8px);box-shadow:0 20px 56px rgba(0,0,0,.7)}
.blade-card-inner{display:flex;flex-direction:column;height:100%;position:relative;z-index:1}
.blade-card-top{display:flex;justify-content:space-between;align-items:flex-start}
.blade-card-logo{font-size:.82rem;font-weight:700;letter-spacing:.04em}
.blade-card-chip{width:36px;height:28px;border-radius:5px;margin:10px 0 auto;background:linear-gradient(135deg,rgba(245,200,66,.75),rgba(245,200,66,.3));border:1px solid rgba(245,200,66,.2)}
.blade-card-bottom{margin-top:auto}
.blade-card-name{font-size:.95rem;font-weight:600;letter-spacing:.01em;margin-bottom:5px;color:rgba(255,255,255,.9)}
.blade-card-details{display:flex;justify-content:space-between;align-items:flex-end}
.blade-card-handle{font-size:.68rem;color:rgba(255,255,255,.4)}
.blade-card-tier{font-size:.63rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase}
/* themes */
.ct-default{background:linear-gradient(135deg,#1a1a1a 0%,#0d0d0d 100%)}
.ct-red{background:linear-gradient(135deg,#1a0505 0%,#2d0000 100%)}
.ct-gold{background:linear-gradient(135deg,#1a1500 0%,#2d2400 100%)}
.ct-blue{background:linear-gradient(135deg,#001a2d 0%,#000d1a 100%)}
.ct-green{background:linear-gradient(135deg,#001a0a 0%,#000d05 100%)}
.ct-purple{background:linear-gradient(135deg,#12001a 0%,#080010 100%)}
.ct-chrome{background:linear-gradient(135deg,#2d2d2d 0%,#111 60%,#1c1c1c 100%)}
.ct-red .blade-card-logo span,.ct-red .blade-card-tier{color:#ff2d2d}
.ct-gold .blade-card-logo span,.ct-gold .blade-card-tier{color:#f5c842}
.ct-blue .blade-card-logo span,.ct-blue .blade-card-tier{color:#0a84ff}
.ct-green .blade-card-logo span,.ct-green .blade-card-tier{color:#34c759}
.ct-purple .blade-card-logo span,.ct-purple .blade-card-tier{color:#bf5af2}
.ct-chrome .blade-card-logo span{color:#999}
/* color swatches */
.card-picker{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
.cswatch{width:30px;height:30px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;position:relative;flex-shrink:0}
.cswatch.active{border-color:var(--t);transform:scale(1.18)}
.cswatch::after{content:'‚úì';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.6rem;color:#fff;opacity:0;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.8)}
.cswatch.active::after{opacity:1}

/* TV CODE */
.tv-code-display{background:var(--bg3);border:1px solid var(--b);border-radius:12px;padding:32px 24px;text-align:center;margin-top:8px}
.tv-code-val{font-size:3.8rem;font-weight:800;letter-spacing:.28em;font-family:'JetBrains Mono',monospace;transition:filter .3s,opacity .3s;color:var(--t);line-height:1;margin-bottom:6px}
.tv-code-val.blurred{filter:blur(10px);opacity:.45;user-select:none;pointer-events:none}
.tv-code-hint{font-size:.72rem;color:var(--t3);margin-bottom:18px}
.tv-code-actions{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.copy-feedback{font-size:.72rem;color:var(--green);font-weight:600;height:16px;margin-top:10px;opacity:0;transition:opacity .3s}
.copy-feedback.show{opacity:1}

/* ACCESS BUTTONS */
.access-btn{display:flex;align-items:center;gap:10px;padding:15px;background:var(--bg3);border:1px solid var(--b2);border-radius:9px;color:var(--t);font-size:.84rem;font-weight:600;transition:all .2s;position:relative}
.access-btn:hover:not(.locked){background:var(--bg4);border-color:var(--b);transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.4)}
.access-btn.locked{opacity:.35;pointer-events:none}
.access-btn-icon{font-size:1.1rem;flex-shrink:0}
.access-btn-label{flex:1;text-align:left}
.access-btn-tag{font-size:.58rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;padding:2px 7px;border-radius:3px;flex-shrink:0}
.tag-free{background:var(--bg4);color:var(--t3);border:1px solid var(--b)}
.tag-blade{background:var(--red0);color:var(--red);border:1px solid var(--red1)}
.tag-plus{background:rgba(245,200,66,.12);color:var(--yellow);border:1px solid rgba(245,200,66,.25);font-style:italic}

/* SETTINGS */
.settings-label{font-size:.65rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--t3);margin-bottom:10px;padding-bottom:7px;border-bottom:1px solid var(--b);display:block}
.settings-section{margin-bottom:22px}
.avatar-large{width:76px;height:76px;border-radius:50%;background:var(--bg4);border:2px solid var(--b2);display:flex;align-items:center;justify-content:center;font-size:1.7rem;font-weight:700;overflow:hidden;flex-shrink:0}
.avatar-large img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.inline-row{display:flex;gap:8px;align-items:center}
.save-indicator{font-size:.72rem;color:var(--green);font-weight:600;opacity:0;transition:opacity .3s;flex-shrink:0}
.save-indicator.show{opacity:1}

/* MEMBERSHIP TIERS */
.tier-row{padding:16px 18px;border-bottom:1px solid var(--b)}
.tier-row:last-child{border-bottom:none}

/* WELCOME BANNER */
.welcome-banner{background:linear-gradient(135deg,#0d0000 0%,#1a0505 60%,#0d0000 100%);border:1px solid rgba(255,45,45,.18);border-radius:12px;padding:26px;position:relative;overflow:hidden}
.welcome-banner::after{content:'';position:absolute;top:-40px;right:-40px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(255,45,45,.08),transparent 70%);pointer-events:none}
.wb-greeting{font-size:.68rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--red);margin-bottom:8px}
.wb-name{font-size:1.9rem;font-weight:800;letter-spacing:-.04em;margin-bottom:6px;line-height:1}
.wb-sub{font-size:.83rem;color:var(--t2);line-height:1.55}
.wb-actions{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}

/* STATS */
.stats-strip{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--b);border:1px solid var(--b);border-radius:10px;overflow:hidden}
.stat-cell{background:var(--bg2);padding:18px 16px;text-align:center;transition:background .15s}
.stat-cell:hover{background:var(--bg3)}
.stat-num{font-size:1.6rem;font-weight:700;letter-spacing:-.03em;margin-bottom:2px}
.stat-num span{color:var(--red)}
.stat-label{font-size:.7rem;color:var(--t2)}

/* UPGRADE PROMPTS */
.upgrade-card{border-radius:12px;padding:22px;display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap;position:relative;overflow:hidden}
.uc-blade{background:linear-gradient(135deg,#1a0505,#0d0000);border:1px solid rgba(255,45,45,.22)}
.uc-plus{background:linear-gradient(135deg,#1a1500,#0d0900);border:1px solid rgba(245,200,66,.2)}
.uc-blade::before,.uc-plus::before{content:'';position:absolute;top:-30px;right:-30px;width:130px;height:130px;border-radius:50%;pointer-events:none}
.uc-blade::before{background:radial-gradient(circle,rgba(255,45,45,.09),transparent 70%)}
.uc-plus::before{background:radial-gradient(circle,rgba(245,200,66,.08),transparent 70%)}
.uc-text h3{font-size:.9rem;font-weight:700;margin-bottom:4px}
.uc-text p{font-size:.78rem;color:var(--t2);line-height:1.5}

/* INDY CHAT */
.indy-fab{position:fixed;bottom:26px;right:26px;z-index:400;width:52px;height:52px;border-radius:50%;background:var(--red);border:none;color:#fff;font-size:1.25rem;display:none;align-items:center;justify-content:center;box-shadow:0 4px 18px rgba(255,45,45,.4);transition:all .2s}
.indy-fab:hover{transform:scale(1.08);box-shadow:0 6px 26px rgba(255,45,45,.5)}
.indy-fab.open{background:var(--bg3);border:1px solid var(--b2);color:var(--t2);font-size:1rem;box-shadow:none}
.indy-chat{position:fixed;bottom:90px;right:26px;z-index:400;width:350px;max-height:510px;background:var(--bg2);border:1px solid var(--b2);border-radius:14px;display:none;flex-direction:column;box-shadow:0 12px 48px rgba(0,0,0,.7);overflow:hidden;animation:chatIn .2s ease}
@keyframes chatIn{from{opacity:0;transform:translateY(10px) scale(.97)}to{opacity:1;transform:none}}
.indy-chat.open{display:flex}
.chat-header{padding:13px 15px;background:var(--bg3);border-bottom:1px solid var(--b);display:flex;align-items:center;gap:10px;flex-shrink:0}
.chat-av{width:30px;height:30px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-size:.82rem;font-weight:700;flex-shrink:0}
.chat-hname{font-size:.86rem;font-weight:700}
.chat-hstatus{font-size:.68rem;color:var(--green);display:flex;align-items:center;gap:4px}
.chat-hstatus::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--green);flex-shrink:0}
.chat-close-btn{background:none;border:none;color:var(--t3);font-size:.95rem;margin-left:auto;padding:4px;transition:color .15s}
.chat-close-btn:hover{color:var(--t)}
.chat-msgs{flex:1;overflow-y:auto;padding:13px;display:flex;flex-direction:column;gap:9px;min-height:0}
.chat-msgs::-webkit-scrollbar{width:3px}.chat-msgs::-webkit-scrollbar-thumb{background:var(--b2);border-radius:2px}
.chat-msg{max-width:88%}
.chat-msg.user{align-self:flex-end}
.chat-msg.bot{align-self:flex-start}
.chat-bubble{padding:8px 12px;border-radius:9px;font-size:.81rem;line-height:1.55}
.chat-msg.user .chat-bubble{background:var(--red);color:#fff;border-radius:9px 9px 2px 9px}
.chat-msg.bot .chat-bubble{background:var(--bg4);border:1px solid var(--b);border-radius:9px 9px 9px 2px}
.chat-typing{display:flex;gap:4px;align-items:center;padding:8px 12px;background:var(--bg4);border:1px solid var(--b);border-radius:9px;width:fit-content}
.chat-typing span{width:5px;height:5px;background:var(--t3);border-radius:50%;animation:tblink 1.4s infinite}
.chat-typing span:nth-child(2){animation-delay:.2s}
.chat-typing span:nth-child(3){animation-delay:.4s}
@keyframes tblink{0%,80%,100%{opacity:.2}40%{opacity:1}}
.chat-input-row{padding:11px;border-top:1px solid var(--b);display:flex;gap:7px;flex-shrink:0}
.chat-input{flex:1;padding:9px 11px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.82rem;outline:none;resize:none;max-height:80px;transition:border-color .2s;line-height:1.4}
.chat-input:focus{border-color:var(--red)}
.chat-input::placeholder{color:var(--t3)}
.chat-send{padding:9px 13px;background:var(--red);border:none;border-radius:7px;color:#fff;font-size:.8rem;font-weight:600;transition:opacity .15s;flex-shrink:0}
.chat-send:hover{opacity:.88}
.chat-send:disabled{opacity:.4}

/* MODALS */
.modal-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.88);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;padding:24px}
.modal-overlay.open{display:flex}
.modal-box{background:var(--bg2);border:1px solid var(--b2);border-radius:14px;max-width:430px;width:100%;padding:36px;position:relative;animation:modalIn .22s ease;max-height:90vh;overflow-y:auto}
@keyframes modalIn{from{opacity:0;transform:scale(.95) translateY(8px)}to{opacity:1;transform:none}}
.modal-close{position:absolute;top:13px;right:13px;width:28px;height:28px;border-radius:50%;background:var(--bg3);border:1px solid var(--b2);color:var(--t2);font-size:13px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:color .15s}
.modal-close:hover{color:var(--t)}
.modal-tag{font-size:.64rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--red);margin-bottom:9px}
.modal-title{font-size:1.3rem;font-weight:700;letter-spacing:-.02em;margin-bottom:8px}
.modal-sub{font-size:.83rem;color:var(--t2);line-height:1.6;margin-bottom:20px}
.code-input{width:100%;padding:12px 15px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.95rem;letter-spacing:.06em;text-align:center;outline:none;transition:border-color .2s}
.code-input:focus{border-color:var(--red)}
.code-status{font-size:.8rem;margin-top:7px;min-height:17px;font-weight:600}
.modal-note{font-size:.7rem;color:var(--t3);margin-top:12px;line-height:1.6}

/* TOAST */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(10px);background:var(--bg3);border:1px solid var(--b2);border-radius:8px;padding:10px 18px;font-size:.83rem;font-weight:500;z-index:9999;opacity:0;transition:all .3s;white-space:nowrap;box-shadow:0 8px 24px rgba(0,0,0,.6);pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* RESPONSIVE */
@media(max-width:900px){
  .dash-layout{grid-template-columns:1fr}
  .dash-sidebar{position:static;height:auto;flex-direction:column;padding:14px;border-right:none;border-bottom:1px solid var(--b)}
  .sb-user{display:flex;gap:12px;align-items:center}
  .sb-avatar{margin:0;width:40px;height:40px;font-size:1rem}
  .sb-nav{flex-direction:row;flex-wrap:wrap;gap:3px}
  .sb-section-label,.sb-divider{display:none}
  .sb-item{width:auto;padding:7px 10px;font-size:.78rem}
  .sb-item.active{border-left:none;border-bottom:2px solid var(--red)}
  .dash-content{padding:14px}
  .dc-grid2,.dc-grid3{grid-template-columns:1fr}
  .stats-strip{grid-template-columns:1fr}
  .indy-chat{width:calc(100vw - 36px);right:18px}
}
@media(max-width:500px){
  .nav{padding:0 16px}
  .landing-features{grid-template-columns:1fr}
  .auth-panel{padding:22px}
  .blade-card{max-width:100%;height:186px}
  .tv-code-val{font-size:2.8rem}
}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="nav-logo" id="nav-logo">JV<span>ST</span></div>
  <div id="nav-right" class="nav-right">
    <button class="nav-btn" onclick="showScreen('screen-auth');switchTab('signin')">Sign In</button>
    <button class="nav-btn primary" onclick="showScreen('screen-auth');switchTab('signup')">Sign Up</button>
  </div>
</nav>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- INDY FAB -->
<button class="indy-fab" id="indy-fab" onclick="toggleChat()">ü§ñ</button>

<!-- INDY CHAT -->
<div class="indy-chat" id="indy-chat">
  <div class="chat-header">
    <div class="chat-av">I</div>
    <div>
      <div class="chat-hname">Indy</div>
      <div class="chat-hstatus">Online ‚Äî JVST assistant</div>
    </div>
    <button class="chat-close-btn" onclick="toggleChat()">‚úï</button>
  </div>
  <div class="chat-msgs" id="chat-msgs"></div>
  <div class="chat-input-row">
    <textarea class="chat-input" id="chat-input" placeholder="Ask Indy anything‚Ä¶" rows="1" onkeydown="chatKeyDown(event)"></textarea>
    <button class="chat-send" id="chat-send" onclick="sendChat()">‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SCREEN: LANDING ‚ïê‚ïê‚ïê -->
<div class="screen active" id="screen-landing">
  <div class="landing-hero">
    <div class="landing-glow"></div>
    <div class="landing-inner">
      <div class="landing-badge"><span class="pulse-dot"></span> Your digital identity</div>
      <h1 class="landing-title">The <span class="hl">Blade Card.</span><br>One link. All access.</h1>
      <p class="landing-sub">Your JVST membership in card form ‚Äî Indy+, Music, TV, and everything we build next. One account. Forever.</p>
      <div class="landing-btns">
        <button class="btn btn-red" onclick="showScreen('screen-auth');switchTab('signup')">Create account ‚Üí</button>
        <button class="btn btn-ghost" onclick="showScreen('screen-auth');switchTab('signin')">Sign in</button>
      </div>
      <div class="landing-features">
        <div class="lf-card"><div class="lf-icon">üéµ</div><div class="lf-title">Music & Tunes</div><div class="lf-desc">Stream everything in the JVST music ecosystem</div></div>
        <div class="lf-card"><div class="lf-icon">üì∫</div><div class="lf-title">TV Access</div><div class="lf-desc">Unlock your master TV code and watch anywhere</div></div>
        <div class="lf-card"><div class="lf-icon">ü§ñ</div><div class="lf-title">Indy+</div><div class="lf-desc">Unlimited AI ‚Äî culture-aware, no limits, no fluff</div></div>
        <div class="lf-card"><div class="lf-icon">ü™™</div><div class="lf-title">Blade Card</div><div class="lf-desc">Customize your digital identity. Share everything.</div></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SCREEN: AUTH ‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-auth">
  <div class="auth-section">
    <div class="auth-box">
      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="signup" onclick="switchTab('signup')">Sign Up</button>
        <button class="auth-tab" data-tab="signin" onclick="switchTab('signin')">Sign In</button>
      </div>
      <div class="auth-panel active" id="panel-signup">
        <div class="auth-panel-title">Create account</div>
        <div class="auth-panel-sub">Join JVST. Free to start ‚Äî no card required.</div>
        <label class="pic-upload-row" for="su-pic">
          <div class="pic-circle"><img id="pic-preview" style="display:none" alt=""><span id="pic-placeholder">üì∑</span></div>
          <div class="pic-upload-info"><strong>Profile photo</strong>Optional ‚Äî tap to upload</div>
        </label>
        <input type="file" id="su-pic" accept="image/*" style="display:none" onchange="handlePicChange(event)">
        <form onsubmit="handleSignUp(event)">
          <div class="fg"><label>Full Name</label><input type="text" id="su-name" required placeholder="Your name" autocomplete="name"></div>
          <div class="fg"><label>Email</label><input type="email" id="su-email" required placeholder="your@email.com" autocomplete="email"></div>
          <div class="fg"><label>Password</label><input type="password" id="su-password" required placeholder="Min. 6 characters" minlength="6" autocomplete="new-password"></div>
          <div class="form-error" id="su-error"></div>
          <button type="submit" class="btn btn-red btn-full" id="su-btn">Create account ‚Üí</button>
        </form>
        <p style="font-size:.7rem;color:var(--t3);margin-top:11px;line-height:1.6">By signing up you agree to our <a href="terms.html" style="color:var(--t2)">Terms</a> and <a href="privacy.html" style="color:var(--t2)">Privacy Policy</a>.</p>
      </div>
      <div class="auth-panel" id="panel-signin">
        <div class="auth-panel-title">Welcome back</div>
        <div class="auth-panel-sub">Sign in to your Blade Card account.</div>
        <form onsubmit="handleSignIn(event)">
          <div class="fg"><label>Email</label><input type="email" id="si-email" required placeholder="your@email.com" autocomplete="email"></div>
          <div class="fg"><label>Password</label><input type="password" id="si-password" required placeholder="Your password" autocomplete="current-password"></div>
          <div class="form-error" id="si-error"></div>
          <button type="submit" class="btn btn-red btn-full" id="si-btn">Sign in ‚Üí</button>
        </form>
        <p style="font-size:.7rem;color:var(--t3);margin-top:11px">No account? <a href="#" style="color:var(--t2)" onclick="switchTab('signup')">Sign up free</a></p>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SCREEN: ONBOARDING ‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-onboard">
  <div class="onboard-section">
    <div class="onboard-box">
      <div class="onboard-emoji">üëã</div>
      <div class="onboard-title">What should we call you?</div>
      <div class="onboard-sub">Set a nickname ‚Äî this is how you'll appear on your Blade Card and across JVST. You can always change it later.</div>
      <input class="nickname-input" id="onboard-nickname" type="text" maxlength="24" placeholder="Enter a nickname‚Ä¶" autocomplete="off" oninput="onboardInput(this)">
      <div class="nickname-hint" id="onboard-hint">Letters, numbers, underscores. 2‚Äì24 characters.</div>
      <button class="btn btn-red btn-full" id="onboard-btn" onclick="submitOnboard()" disabled>Let's go ‚Üí</button>
      <button class="btn btn-ghost btn-full" style="margin-top:8px;font-size:.8rem" onclick="skipOnboard()">Skip for now</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SCREEN: DASHBOARD ‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-dashboard">
  <div class="dash-layout">

    <!-- SIDEBAR -->
    <aside class="dash-sidebar">
      <div class="sb-user">
        <div class="sb-avatar" id="sb-avatar">?</div>
        <div style="min-width:0;flex:1">
          <div class="sb-nickname" id="sb-nickname">‚Äî</div>
          <div class="sb-handle" id="sb-handle">@‚Äî</div>
          <div id="sb-tier" style="margin-top:5px"></div>
        </div>
      </div>
      <div class="sb-nav">
        <span class="sb-section-label">Dashboard</span>
        <button class="sb-item active" data-panel="home" onclick="switchPanel('home')"><span class="sb-icon">üè†</span>Home</button>
        <button class="sb-item" data-panel="card" onclick="switchPanel('card')"><span class="sb-icon">ü™™</span>Blade Card</button>
        <button class="sb-item" data-panel="access" onclick="switchPanel('access')"><span class="sb-icon">‚ö°</span>Quick Access</button>
        <button class="sb-item" data-panel="tv" onclick="switchPanel('tv')"><span class="sb-icon">üì∫</span>TV Code</button>
        <span class="sb-section-label">Account</span>
        <button class="sb-item" data-panel="settings" onclick="switchPanel('settings')"><span class="sb-icon">‚öôÔ∏è</span>Settings</button>
        <button class="sb-item" data-panel="membership" onclick="switchPanel('membership')"><span class="sb-icon">‚ú®</span>Membership</button>
        <div class="sb-divider"></div>
        <a href="https://www.shopjust.store" class="sb-item"><span class="sb-icon">‚Üê</span>JVST Home</a>
        <a href="indy.html" class="sb-item"><span class="sb-icon">ü§ñ</span>Open Indy 3</a>
        <button class="sb-item sb-danger" onclick="handleSignOut()"><span class="sb-icon">‚èè</span>Sign Out</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="dash-main">
      <div class="dash-content">

        <!-- HOME PANEL -->
        <div class="panel active" id="panel-home">
          <div class="welcome-banner">
            <div class="wb-greeting">Welcome back</div>
            <div class="wb-name" id="wb-name">‚Äî</div>
            <div class="wb-sub" id="wb-sub">Loading‚Ä¶</div>
            <div class="wb-actions" id="wb-actions"></div>
          </div>
          <div class="stats-strip">
            <div class="stat-cell"><div class="stat-num"><span>100</span>+</div><div class="stat-label">Active Members</div></div>
            <div class="stat-cell"><div class="stat-num"><span>99.9</span>%</div><div class="stat-label">Uptime</div></div>
            <div class="stat-cell"><div class="stat-num"><span>24</span>/7</div><div class="stat-label">Support</div></div>
          </div>
          <div class="dc">
            <div class="dc-label">Quick Access</div>
            <div class="dc-grid2" id="home-access-grid" style="margin-top:10px"></div>
          </div>
          <div id="home-upgrade-wrap"></div>
        </div>

        <!-- BLADE CARD PANEL -->
        <div class="panel" id="panel-card">
          <div class="dc">
            <div class="dc-label">Your Blade Card</div>
            <div class="dc-title">Digital identity, done right.</div>
            <div class="dc-sub" style="margin-bottom:20px">Your JVST membership in card form ‚Äî shareable, stylish, yours.</div>
            <div class="blade-card-wrap">
              <div id="blade-card" class="blade-card ct-default">
                <div class="blade-card-inner">
                  <div class="blade-card-top"><div class="blade-card-logo">JV<span>ST</span></div></div>
                  <div class="blade-card-chip"></div>
                  <div class="blade-card-bottom">
                    <div class="blade-card-name" id="card-preview-name">Your Name</div>
                    <div class="blade-card-details">
                      <div class="blade-card-handle" id="card-preview-handle">@handle</div>
                      <div class="blade-card-tier" id="card-preview-tier">‚óã Free</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="dc">
            <div class="dc-label">Card Theme</div>
            <div class="dc-title">Choose your color</div>
            <div class="dc-sub">Pick a look ‚Äî saved to your account instantly.</div>
            <div class="card-picker" id="card-picker">
              <div class="cswatch active" data-theme="default" title="Default" style="background:linear-gradient(135deg,#1a1a1a,#0d0d0d)" onclick="setCardTheme('default')"></div>
              <div class="cswatch" data-theme="red" title="Red" style="background:linear-gradient(135deg,#2d0000,#1a0505)" onclick="setCardTheme('red')"></div>
              <div class="cswatch" data-theme="gold" title="Gold" style="background:linear-gradient(135deg,#2d2400,#1a1500)" onclick="setCardTheme('gold')"></div>
              <div class="cswatch" data-theme="blue" title="Blue" style="background:linear-gradient(135deg,#001a2d,#000d1a)" onclick="setCardTheme('blue')"></div>
              <div class="cswatch" data-theme="green" title="Green" style="background:linear-gradient(135deg,#001a0a,#000d05)" onclick="setCardTheme('green')"></div>
              <div class="cswatch" data-theme="purple" title="Purple" style="background:linear-gradient(135deg,#12001a,#080010)" onclick="setCardTheme('purple')"></div>
              <div class="cswatch" data-theme="chrome" title="Chrome" style="background:linear-gradient(135deg,#2d2d2d,#111)" onclick="setCardTheme('chrome')"></div>
            </div>
            <p style="font-size:.7rem;color:var(--t3);margin-top:10px" id="theme-note"></p>
          </div>
          <div class="dc">
            <div class="dc-label">Card Display Name</div>
            <div class="dc-sub" style="margin-bottom:12px">The name shown on your card ‚Äî can be your nickname, handle, or real name.</div>
            <div class="inline-row">
              <input type="text" id="card-name-input" placeholder="Name on card" maxlength="28" style="flex:1;padding:10px 12px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.88rem;outline:none;transition:border-color .2s" oninput="liveUpdateCardName(this.value)" onfocus="this.style.borderColor='var(--red)'" onblur="this.style.borderColor='var(--b2)'">
              <button class="btn btn-ghost btn-sm" onclick="saveCardName()">Save</button>
              <span class="save-indicator" id="card-name-saved">Saved ‚úì</span>
            </div>
          </div>
        </div>

        <!-- QUICK ACCESS PANEL -->
        <div class="panel" id="panel-access">
          <div class="dc">
            <div class="dc-label">Quick Access</div>
            <div class="dc-title">All your services</div>
            <div class="dc-sub" style="margin-bottom:18px">Blade Card unlocks Tunes + TV. One members get everything.</div>
            <div class="dc-grid2" id="full-access-grid"></div>
          </div>
          <div id="access-upgrade-wrap"></div>
        </div>

        <!-- TV CODE PANEL -->
        <div class="panel" id="panel-tv">
          <div class="dc" id="tv-locked">
            <div class="dc-label">üîí Locked</div>
            <div class="dc-title">Blade Card required</div>
            <div class="dc-sub">Activate your Blade Card to access your master TV code.</div>
            <div class="dc-actions"><button class="btn btn-red btn-sm" onclick="openActivate()">Activate Now ‚Üí</button></div>
          </div>
          <div class="dc" id="tv-unlocked" style="display:none">
            <div class="dc-label"><span class="pulse-dot"></span> Master TV Code</div>
            <div class="dc-title">Your access code</div>
            <div class="dc-sub">Log in on any JVST TV screen. <strong style="color:var(--red)">Never share this code.</strong></div>
            <div class="tv-code-display">
              <div class="tv-code-val blurred" id="tv-code-val">3p#q</div>
              <div class="tv-code-hint">Tap reveal to see your code</div>
              <div class="tv-code-actions">
                <button class="btn btn-ghost btn-sm" id="tv-reveal-btn" onclick="toggleTvCode()">üëÅ Reveal</button>
                <button class="btn btn-ghost btn-sm" id="tv-copy-btn" onclick="copyTvCode()" style="display:none">üìã Copy</button>
                <button class="btn btn-ghost btn-sm" onclick="window.open('https://www.shopjust.store/tv.html','_blank')">Open TV ‚Üí</button>
              </div>
              <div class="copy-feedback" id="copy-fb">Copied to clipboard!</div>
            </div>
          </div>
          <div class="dc">
            <div class="dc-label">How it works</div>
            <div style="display:flex;flex-direction:column;gap:14px;margin-top:4px">
              <div style="display:flex;gap:12px;align-items:flex-start"><div style="width:24px;height:24px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;flex-shrink:0;margin-top:1px">1</div><div><div style="font-size:.86rem;font-weight:600;margin-bottom:2px">Reveal your code</div><div style="font-size:.78rem;color:var(--t2)">Hit the reveal button and keep it private</div></div></div>
              <div style="display:flex;gap:12px;align-items:flex-start"><div style="width:24px;height:24px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;flex-shrink:0;margin-top:1px">2</div><div><div style="font-size:.86rem;font-weight:600;margin-bottom:2px">Open JVST TV</div><div style="font-size:.78rem;color:var(--t2)">Navigate to TV on any screen or browser</div></div></div>
              <div style="display:flex;gap:12px;align-items:flex-start"><div style="width:24px;height:24px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;flex-shrink:0;margin-top:1px">3</div><div><div style="font-size:.86rem;font-weight:600;margin-bottom:2px">Enter your code</div><div style="font-size:.78rem;color:var(--t2)">Type your code to authenticate ‚Äî instant access</div></div></div>
            </div>
          </div>
        </div>

        <!-- SETTINGS PANEL -->
        <div class="panel" id="panel-settings">
          <div class="dc">
            <div class="dc-label">Profile Settings</div>
            <div class="settings-section" style="margin-top:16px">
              <span class="settings-label">Profile Photo</span>
              <div style="display:flex;align-items:center;gap:14px">
                <div class="avatar-large" id="settings-avatar">?</div>
                <div>
                  <div style="font-size:.82rem;color:var(--t2);margin-bottom:8px;line-height:1.5">Shown on your Blade Card and across JVST</div>
                  <label class="btn btn-ghost btn-sm" for="settings-pic" style="cursor:pointer;display:inline-flex">Change photo</label>
                  <input type="file" id="settings-pic" accept="image/*" style="display:none" onchange="handleSettingsPic(event)">
                </div>
              </div>
            </div>
            <div class="settings-section">
              <span class="settings-label">Nickname</span>
              <div class="inline-row">
                <input type="text" id="settings-nickname" placeholder="Your nickname" maxlength="24" style="flex:1;padding:10px 12px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.88rem;outline:none;transition:border-color .2s" onfocus="this.style.borderColor='var(--red)'" onblur="this.style.borderColor='var(--b2)'">
                <button class="btn btn-ghost btn-sm" onclick="saveNickname()">Save</button>
                <span class="save-indicator" id="nick-saved">Saved ‚úì</span>
              </div>
              <p style="font-size:.7rem;color:var(--t3);margin-top:5px">This is how you appear across JVST.</p>
            </div>
            <div class="settings-section">
              <span class="settings-label">Display Name</span>
              <div class="inline-row">
                <input type="text" id="settings-dispname" placeholder="Full name" maxlength="40" style="flex:1;padding:10px 12px;background:var(--bg3);border:1px solid var(--b2);border-radius:7px;color:var(--t);font-size:.88rem;outline:none;transition:border-color .2s" onfocus="this.style.borderColor='var(--red)'" onblur="this.style.borderColor='var(--b2)'">
                <button class="btn btn-ghost btn-sm" onclick="saveDispName()">Save</button>
                <span class="save-indicator" id="dn-saved">Saved ‚úì</span>
              </div>
            </div>
            <div class="settings-section" style="margin-bottom:0">
              <span class="settings-label">Email</span>
              <div style="padding:10px 12px;background:var(--bg3);border:1px solid var(--b);border-radius:7px;font-size:.87rem;color:var(--t2)" id="settings-email">‚Äî</div>
            </div>
          </div>
          <div class="dc">
            <div class="dc-label">Danger Zone</div>
            <div class="dc-sub" style="margin-bottom:14px">Sign out of your current session on this device.</div>
            <button class="btn btn-ghost btn-sm" style="border-color:rgba(255,45,45,.35);color:var(--red)" onclick="handleSignOut()">Sign Out</button>
          </div>
        </div>

        <!-- MEMBERSHIP PANEL -->
        <div class="panel" id="panel-membership">
          <div class="dc"><div class="dc-label">Your Membership</div><div id="membership-status" style="margin-top:10px"></div></div>
          <div id="membership-upgrade-wrap"></div>
          <div class="dc">
            <div class="dc-label">Tier Breakdown</div>
            <div style="border:1px solid var(--b);border-radius:10px;overflow:hidden;margin-top:12px">
              <div class="tier-row"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><span style="font-size:.86rem;font-weight:600">Free</span><span class="tier-badge free">Free</span></div><div style="font-size:.77rem;color:var(--t2);line-height:1.55">Indy 3 (30 min sessions), community features, basic Blade Card profile.</div></div>
              <div class="tier-row" style="background:linear-gradient(90deg,var(--red0),transparent)"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><span style="font-size:.86rem;font-weight:600">Blade Card</span><span class="tier-badge premium">Blade Card</span></div><div style="font-size:.77rem;color:var(--t2);line-height:1.55">Everything Free + Tunes streaming, TV code access, custom card themes, shareable QR.</div></div>
              <div class="tier-row" style="background:linear-gradient(90deg,rgba(245,200,66,.06),transparent);border-bottom:none"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><span style="font-size:.86rem;font-weight:600">One (Plus)</span><span class="tier-badge plus">‚≠ê One</span></div><div style="font-size:.77rem;color:var(--t2);line-height:1.55">Everything Blade Card + Indy+ unlimited, mini-crafts, collab perks, early feature access.</div></div>
            </div>
          </div>
          <div class="dc">
            <div class="dc-label">Need Help?</div>
            <div class="dc-sub" style="margin-bottom:12px">Questions about codes or access? We're real humans who read every email.</div>
            <a href="mailto:hello@shopjust.store" class="btn btn-ghost btn-sm">Contact JVST ‚Üí</a>
          </div>
        </div>

        <!-- FOOTER -->
        <div style="font-size:.69rem;color:var(--t3);padding-top:8px;border-top:1px solid var(--b);line-height:1.9">
          ¬© 2026 JVST Inc. ‚Ä¢ Blade Card ‚Ä¢ Sharing codes is strictly prohibited<br>
          <a href="https://www.shopjust.store" style="color:var(--t2)">Home</a> ¬∑ <a href="terms.html" style="color:var(--t2)">Terms</a> ¬∑ <a href="privacy.html" style="color:var(--t2)">Privacy</a>
        </div>

      </div>
    </main>
  </div>
</div>

<!-- ACTIVATE MODAL -->
<div class="modal-overlay" id="activate-modal" onclick="if(event.target===this)closeActivate()">
  <div class="modal-box">
    <button class="modal-close" onclick="closeActivate()">‚úï</button>
    <div class="modal-tag">Blade Card Activation</div>
    <div class="modal-title">Enter your card code</div>
    <div class="modal-sub">Case-insensitive. Activates Blade Card membership permanently on your account.</div>
    <input class="code-input" id="act-input" type="text" maxlength="24" placeholder="Enter code here" autocomplete="off" oninput="handleActCode(event)">
    <div class="code-status" id="act-status"></div>
    <div class="form-error" id="act-error"></div>
    <p class="modal-note">No code? <a href="mailto:hello@shopjust.store" style="color:var(--t2)">Contact us</a> or visit the <a href="https://www.shopjust.store#pricing" style="color:var(--t2)">pricing page</a>.</p>
  </div>
</div>

<!-- PLUS MODAL -->
<div class="modal-overlay" id="plus-modal" onclick="if(event.target===this)closePlus()">
  <div class="modal-box">
    <button class="modal-close" onclick="closePlus()">‚úï</button>
    <div class="modal-tag">Plus ‚Äî One Membership</div>
    <div class="modal-title">Activate <span style="color:var(--yellow)">Plus</span></div>
    <div class="modal-sub">One Plus code = lifetime One membership. Unlocks Indy+ and mini-crafts immediately.</div>
    <form onsubmit="handlePlusCode(event)">
      <div class="fg" style="margin-bottom:6px"><label>Plus Code</label><input class="code-input" id="plus-input" type="text" maxlength="24" placeholder="Enter Plus code" autocomplete="off" style="text-align:left;letter-spacing:0;font-size:.88rem"></div>
      <div class="form-error" id="plus-error"></div>
      <button type="submit" class="btn btn-full btn-yellow" style="margin-top:6px">Activate Plus ‚Üí</button>
    </form>
    <p class="modal-note">Plus codes are distributed via JVST partnerships. <a href="mailto:hello@shopjust.store" style="color:var(--t2)">Contact us</a> if you think you should have access.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê FIREBASE MODULE SCRIPT ‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref as sRef, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const FB = { apiKey:"AIzaSyC50_wBK3TfERX1gm35puugCD324SxHJR8", authDomain:"tunesandindy.firebaseapp.com", projectId:"tunesandindy", storageBucket:"tunesandindy.firebasestorage.app", messagingSenderId:"335192973371", appId:"1:335192973371:web:ce69d4b67c765d6aaf7c1e" };
const CODES = ["cutedrunkraccoons","blade","card5","golds","tv482","ai4me","trash","panda31","rocket","nebul","qubit","zorp9","kryp7","fluxx","vortex","spark","3p#q","goldpass","rynxdog"];
headers:{ 
  'Content-Type':'application/json', 
  'Authorization':`Bearer ${process.env.GROQ_KEY}` 
},
const TV_CODE = "3p#q";

const app = initializeApp(FB);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let CU = null, UP = {}, chatHist = [], tvVisible = false;

// ‚îÄ‚îÄ AUTH STATE ‚îÄ‚îÄ
onAuthStateChanged(auth, async user => {
  CU = user;
  if (user) {
    await loadProfile(user.uid);
    updateNav(true);
    document.getElementById('indy-fab').style.display = 'flex';
    if (!UP.onboarded) { showScreen('screen-onboard'); }
    else { bootDash(); showScreen('screen-dashboard'); }
  } else {
    CU = null; UP = {};
    updateNav(false);
    document.getElementById('indy-fab').style.display = 'none';
    document.getElementById('indy-chat').classList.remove('open');
    document.getElementById('indy-fab').classList.remove('open');
    showScreen('screen-landing');
  }
});

async function loadProfile(uid) {
  try {
    const snap = await getDoc(doc(db,'users',uid));
    UP = snap.exists() ? snap.data() : {};
  } catch { UP = {}; }
  UP.isPremium = UP.isPremium || false;
  UP.isPlus = UP.isPlus || false;
  UP.onboarded = UP.onboarded || false;
}

async function saveField(k, v) {
  if (!CU) return;
  UP[k] = v;
  try { await updateDoc(doc(db,'users',CU.uid), {[k]:v}); } catch {}
}

// ‚îÄ‚îÄ SIGN UP ‚îÄ‚îÄ
window.handleSignUp = async e => {
  e.preventDefault();
  const nm = document.getElementById('su-name').value.trim();
  const em = document.getElementById('su-email').value.trim();
  const pw = document.getElementById('su-password').value;
  const btn = document.getElementById('su-btn');
  const err = document.getElementById('su-error');
  err.textContent = '';
  setBtn(btn, true);
  try {
    const c = await createUserWithEmailAndPassword(auth, em, pw);
    await updateProfile(c.user, { displayName: nm });
    let photoURL = null;
    const pf = document.getElementById('su-pic').files[0];
    if (pf) { try { const d = await readFile(pf); const r = sRef(storage,`profiles/${c.user.uid}`); await uploadString(r,d,'data_url'); photoURL = await getDownloadURL(r); await updateProfile(c.user,{photoURL}); } catch {} }
    await setDoc(doc(db,'users',c.user.uid), { name:nm, email:em, photoURL:photoURL||null, nickname:'', cardTheme:'default', cardName:'', isPremium:false, isPlus:false, onboarded:false, createdAt:new Date().toISOString() });
    toast('Account created! üéâ');
  } catch(e) { err.textContent = fErr(e.code); }
  finally { setBtn(btn, false); }
};

// ‚îÄ‚îÄ SIGN IN ‚îÄ‚îÄ
window.handleSignIn = async e => {
  e.preventDefault();
  const em = document.getElementById('si-email').value.trim();
  const pw = document.getElementById('si-password').value;
  const btn = document.getElementById('si-btn');
  const err = document.getElementById('si-error');
  err.textContent = '';
  setBtn(btn, true);
  try { await signInWithEmailAndPassword(auth, em, pw); toast('Welcome back üëã'); }
  catch(e) { err.textContent = fErr(e.code); }
  finally { setBtn(btn, false); }
};

// ‚îÄ‚îÄ SIGN OUT ‚îÄ‚îÄ
window.handleSignOut = async () => { await signOut(auth); toast('Signed out. See you soon.'); };

// ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ
window.onboardInput = el => {
  const v = el.value.trim();
  const ok = /^[a-zA-Z0-9_]{2,24}$/.test(v);
  document.getElementById('onboard-btn').disabled = !ok;
  const hint = document.getElementById('onboard-hint');
  hint.textContent = ok ? `Looks good, "${v}" üëç` : 'Letters, numbers, underscores. 2‚Äì24 characters.';
  hint.style.color = ok ? 'var(--green)' : 'var(--t3)';
};
window.submitOnboard = async () => {
  const nick = document.getElementById('onboard-nickname').value.trim();
  await saveField('nickname', nick);
  await saveField('onboarded', true);
  bootDash();
  showScreen('screen-dashboard');
  toast(`Hey ${nick}! Welcome to JVST üéâ`);
};
window.skipOnboard = async () => {
  await saveField('onboarded', true);
  bootDash();
  showScreen('screen-dashboard');
};

// ‚îÄ‚îÄ BOOT DASHBOARD ‚îÄ‚îÄ
function bootDash() {
  const user = CU; if (!user) return;
  const isPremium = UP.isPremium, isPlus = UP.isPlus;
  const dispName = user.displayName || UP.name || 'Member';
  const nick = UP.nickname || dispName.split(' ')[0] || 'Member';
  const handle = '@' + (user.email?.split('@')[0] || 'member');
  const photo = user.photoURL || UP.photoURL;

  // sidebar
  setAv('sb-avatar', photo, nick);
  setTxt('sb-nickname', nick);
  setTxt('sb-handle', handle);
  setTierBadge('sb-tier', isPremium, isPlus);

  // settings
  setAv('settings-avatar', photo, nick);
  document.getElementById('settings-nickname').value = nick;
  document.getElementById('settings-dispname').value = dispName;
  document.getElementById('settings-email').textContent = user.email || '‚Äî';

  // welcome
  setTxt('wb-name', nick);
  setTxt('wb-sub', isPlus ? '‚≠ê One Member ‚Äî full access unlocked' : isPremium ? '‚ú® Blade Card Member ‚Äî welcome back' : 'Free member ‚Äî activate your Blade Card to unlock more');
  renderWbActions(isPremium, isPlus);

  // home quick grid
  document.getElementById('home-access-grid').innerHTML = buildAccessBtns();
  renderHomeUpgrade(isPremium, isPlus);

  // blade card
  const cardName = UP.cardName || nick;
  document.getElementById('card-name-input').value = cardName;
  setTxt('card-preview-name', cardName);
  setTxt('card-preview-handle', handle);
  setTxt('card-preview-tier', isPlus ? '‚≠ê One' : isPremium ? '‚ú® Blade' : '‚óã Free');
  applyCardTheme(UP.cardTheme || 'default');

  // access panel
  document.getElementById('full-access-grid').innerHTML = buildAccessBtns(true);
  renderAccessUpgrade(isPremium);

  // tv panel
  document.getElementById('tv-locked').style.display = isPremium ? 'none' : 'block';
  document.getElementById('tv-unlocked').style.display = isPremium ? 'block' : 'none';

  // membership
  renderMembership(isPremium, isPlus, nick);
}

function renderWbActions(isPremium, isPlus) {
  const el = document.getElementById('wb-actions');
  let h = '';
  if (isPremium) {
    h += `<button class="btn btn-red btn-sm" onclick="window.open('https://www.shopjust.store/tunes.html','_blank')">üéµ Tunes</button>`;
    h += `<button class="btn btn-ghost btn-sm" onclick="switchPanel('tv')">üì∫ TV Code</button>`;
  } else {
    h += `<button class="btn btn-red btn-sm" onclick="openActivate()">ü™™ Activate Card ‚Üí</button>`;
  }
  if (isPlus) h += `<button class="btn btn-ghost btn-sm" onclick="window.open('https://www.shopjust.store/indyplus.html','_blank')">ü§ñ Indy+</button>`;
  el.innerHTML = h;
}

function buildAccessBtns(all) {
  const iP = UP.isPremium, iL = UP.isPlus;
  const items = [
    { icon:'üéµ', label:'Tunes', need:'blade', url:'https://www.shopjust.store/tunes.html' },
    { icon:'üì∫', label:'TV', need:'blade', url:'https://www.shopjust.store/tv.html' },
    { icon:'ü§ñ', label:'Indy+', need:'plus', url:'https://www.shopjust.store/indyplus.html' },
    { icon:'‚úÇÔ∏è', label:'mini-crafts', need:'plus', url:'https://www.mini-crafts.com' },
    { icon:'ü§ñ', label:'Indy 3 (Free)', need:'none', url:'indy.html' },
    ...(all ? [{ icon:'üè†', label:'JVST Home', need:'none', url:'https://www.shopjust.store' }] : [])
  ];
  return items.map(it => {
    const ok = it.need==='none'||(it.need==='blade'&&iP)||(it.need==='plus'&&iL);
    const tagCls = it.need==='plus'?'tag-plus':it.need==='blade'?'tag-blade':'tag-free';
    const tagLbl = it.need==='plus'?'Plus':it.need==='blade'?'Blade':'Free';
    const lockIcon = !ok ? '<span style="font-size:.8rem;color:var(--t3);margin-left:auto">üîí</span>' : '';
    const action = ok ? `onclick="window.open('${it.url}','_blank')"` : it.need==='plus' ? `onclick="openPlus()"` : `onclick="openActivate()"`;
    return `<button class="access-btn${!ok?' locked':''}" ${action}><span class="access-btn-icon">${it.icon}</span><span class="access-btn-label">${it.label}</span><span class="access-btn-tag ${tagCls}">${tagLbl}</span>${lockIcon}</button>`;
  }).join('');
}

function renderHomeUpgrade(iP, iL) {
  const el = document.getElementById('home-upgrade-wrap'); if (!el) return;
  if (iP) { el.innerHTML = ''; return; }
  el.innerHTML = `<div class="dc"><div class="dc-label"><span class="pulse-dot"></span> Activate</div><div class="dc-title">Unlock your Blade Card</div><div class="dc-sub">Enter your code to unlock Tunes, TV codes, and your digital card identity.</div><div class="dc-actions"><button class="btn btn-red btn-sm" onclick="openActivate()">Enter Code ‚Üí</button><button class="btn btn-ghost btn-sm" onclick="switchPanel('membership')">Learn More</button></div></div>`;
}

function renderAccessUpgrade(iP) {
  const el = document.getElementById('access-upgrade-wrap'); if (!el) return;
  if (iP) { el.innerHTML = ''; return; }
  el.innerHTML = `<div class="dc"><div class="dc-sub" style="color:var(--t3)">üîí Tunes and TV require a Blade Card. <button style="background:none;border:none;color:var(--red);font-weight:600;cursor:pointer;font-family:inherit;font-size:.82rem" onclick="openActivate()">Activate ‚Üí</button></div></div>`;
}

function renderMembership(iP, iL, nick) {
  const status = document.getElementById('membership-status');
  let h = '';
  if (iL) h = `<div style="display:inline-flex;align-items:center;gap:8px;padding:6px 14px;background:rgba(245,200,66,.1);border:1px solid rgba(245,200,66,.25);border-radius:6px;margin-bottom:12px"><span>‚≠ê</span><span style="font-size:.86rem;font-weight:700;color:var(--yellow)">One Member</span></div><p style="font-size:.85rem;color:var(--t2);line-height:1.65">Full access ‚Äî Tunes, TV, Indy+, mini-crafts. You're at the top tier. üôå</p>`;
  else if (iP) h = `<div style="display:inline-flex;align-items:center;gap:8px;padding:6px 14px;background:var(--red0);border:1px solid var(--red1);border-radius:6px;margin-bottom:12px"><span>‚ú®</span><span style="font-size:.86rem;font-weight:700;color:var(--red)">Blade Card Member</span></div><p style="font-size:.85rem;color:var(--t2);line-height:1.65">Tunes and TV unlocked. Upgrade to Plus for Indy+ and mini-crafts.</p>`;
  else h = `<div style="display:inline-flex;align-items:center;gap:8px;padding:6px 14px;background:var(--bg4);border:1px solid var(--b2);border-radius:6px;margin-bottom:12px"><span>‚óã</span><span style="font-size:.86rem;font-weight:600;color:var(--t3)">Free</span></div><p style="font-size:.85rem;color:var(--t2);line-height:1.65">On the free plan. Activate a code to unlock more.</p>`;
  if (status) status.innerHTML = h;
  const wrap = document.getElementById('membership-upgrade-wrap');
  if (wrap) {
    let uh = '';
    if (!iP) uh += `<div class="dc"><div class="upgrade-card uc-blade"><div class="uc-text"><h3>ü™™ Activate Blade Card</h3><p>Unlock Tunes, TV, and your digital card. One code, lifetime access.</p></div><button class="btn btn-red btn-sm" onclick="openActivate()">Enter Code ‚Üí</button></div></div>`;
    if (iP && !iL) uh += `<div class="dc"><div class="upgrade-card uc-plus"><div class="uc-text"><h3>‚≠ê Activate Plus (One)</h3><p>Get Indy+ and mini-crafts. One code, lifetime membership.</p></div><button class="btn btn-yellow btn-sm" onclick="openPlus()">Activate Plus ‚Üí</button></div></div>`;
    wrap.innerHTML = uh;
  }
}

// ‚îÄ‚îÄ CARD THEME ‚îÄ‚îÄ
window.setCardTheme = async theme => {
  applyCardTheme(theme);
  await saveField('cardTheme', theme);
  setTxt('theme-note', '‚úì Theme saved');
  setTimeout(() => setTxt('theme-note', ''), 2200);
};
function applyCardTheme(theme) {
  const card = document.getElementById('blade-card');
  if (!card) return;
  card.className = `blade-card ct-${theme}`;
  document.querySelectorAll('.cswatch').forEach(s => s.classList.toggle('active', s.dataset.theme === theme));
}
window.liveUpdateCardName = v => setTxt('card-preview-name', v || 'Your Name');
window.saveCardName = async () => {
  const v = document.getElementById('card-name-input').value.trim();
  if (!v) return;
  await saveField('cardName', v);
  setTxt('card-preview-name', v);
  showSave('card-name-saved');
};

// ‚îÄ‚îÄ TV CODE ‚îÄ‚îÄ
window.toggleTvCode = () => {
  tvVisible = !tvVisible;
  document.getElementById('tv-code-val').classList.toggle('blurred', !tvVisible);
  document.getElementById('tv-reveal-btn').textContent = tvVisible ? 'üôà Hide' : 'üëÅ Reveal';
  document.getElementById('tv-copy-btn').style.display = tvVisible ? 'inline-flex' : 'none';
};
window.copyTvCode = () => {
  navigator.clipboard.writeText(TV_CODE).then(() => {
    const fb = document.getElementById('copy-fb');
    fb.classList.add('show');
    setTimeout(() => fb.classList.remove('show'), 2000);
  });
};

// ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ
window.saveNickname = async () => {
  const v = document.getElementById('settings-nickname').value.trim();
  if (!v || v.length < 2) return;
  await saveField('nickname', v);
  setTxt('sb-nickname', v); setTxt('wb-name', v);
  showSave('nick-saved'); toast('Nickname updated!');
};
window.saveDispName = async () => {
  const v = document.getElementById('settings-dispname').value.trim();
  if (!v) return;
  try { await updateProfile(CU, { displayName: v }); } catch {}
  await saveField('name', v);
  showSave('dn-saved'); toast('Name updated!');
};
window.handleSettingsPic = async e => {
  const f = e.target.files[0]; if (!f || !CU) return;
  toast('Uploading‚Ä¶');
  try {
    const d = await readFile(f);
    const r = sRef(storage, `profiles/${CU.uid}`);
    await uploadString(r, d, 'data_url');
    const url = await getDownloadURL(r);
    await updateProfile(CU, { photoURL: url });
    await saveField('photoURL', url);
    setAv('settings-avatar', url, '');
    setAv('sb-avatar', url, '');
    toast('Photo updated ‚úì');
  } catch { toast('Upload failed. Try again.'); }
};

// ‚îÄ‚îÄ ACTIVATE MODAL ‚îÄ‚îÄ
window.openActivate = () => {
  document.getElementById('activate-modal').classList.add('open');
  document.getElementById('act-input').value = '';
  document.getElementById('act-status').textContent = '';
  document.getElementById('act-error').textContent = '';
  setTimeout(() => document.getElementById('act-input').focus(), 80);
};
window.closeActivate = () => document.getElementById('activate-modal').classList.remove('open');
window.handleActCode = async e => {
  const code = e.target.value.trim().toLowerCase();
  const status = document.getElementById('act-status');
  const err = document.getElementById('act-error');
  err.textContent = ''; e.target.style.borderColor = '';
  if (code.length < 4) { status.textContent = ''; return; }
  if (CODES.includes(code)) {
    status.textContent = '‚úì Valid code!'; status.style.color = 'var(--green)';
    e.target.style.borderColor = 'var(--green)';
    setTimeout(async () => {
      try {
        await updateDoc(doc(db,'users',CU.uid), { isPremium:true });
        UP.isPremium = true; e.target.value = ''; e.target.style.borderColor = '';
        status.textContent = ''; closeActivate(); bootDash(); toast('Blade Card activated! ‚ú®');
      } catch { err.textContent = 'Error saving. Try again.'; }
    }, 500);
  } else if (code.length >= 4) {
    err.textContent = 'Code not recognized ‚Äî try again.';
    e.target.style.borderColor = 'var(--red)';
    setTimeout(() => { e.target.style.borderColor = ''; err.textContent = ''; }, 1500);
  }
};

// ‚îÄ‚îÄ PLUS MODAL ‚îÄ‚îÄ
window.openPlus = () => {
  document.getElementById('plus-modal').classList.add('open');
  document.getElementById('plus-input').value = '';
  document.getElementById('plus-error').textContent = '';
  setTimeout(() => document.getElementById('plus-input').focus(), 80);
};
window.closePlus = () => document.getElementById('plus-modal').classList.remove('open');
window.handlePlusCode = async e => {
  e.preventDefault();
  const code = document.getElementById('plus-input').value.trim().toLowerCase();
  const err = document.getElementById('plus-error');
  if (CODES.includes(code)) {
    try {
      await updateDoc(doc(db,'users',CU.uid), { isPlus:true, isPremium:true });
      UP.isPlus = true; UP.isPremium = true;
      closePlus(); bootDash(); toast('Plus activated! üåü Full access unlocked.');
    } catch { err.textContent = 'Error activating. Try again.'; }
  } else { err.textContent = 'That code is not valid for Plus.'; }
};

// ‚îÄ‚îÄ INDY AI CHAT ‚îÄ‚îÄ
const SYSTEM_PROMPT = () => {
  const nick = UP.nickname || CU?.displayName?.split(' ')[0] || 'Member';
  const iP = UP.isPremium, iL = UP.isPlus;
  const tier = iL ? 'One (Plus) ‚Äî full access' : iP ? 'Blade Card Member ‚Äî premium' : 'Free member';
  return `You are Indy, the official JVST AI assistant/tour guide built into the Blade Card dashboard. Warm, direct, culturally-aware. You talk like a smart friend ‚Äî not corporate. Keep responses concise and helpful. Never say "I'd be happy to help!" you can strictly only talk about the JVST website, user account, and related services. You know the user's account details and site features deeply. Always tailor your responses based on their tier and access. If they ask about something they don't have access to, explain what it is and how to unlock it. Use emojis and casual language to keep it friendly. Be proactive in offering help related to their account and the site.

CURRENT USER: Nickname: ${nick} | Tier: ${tier} | Email: ${CU?.email||'unknown'} | Tunes: ${iP?'‚úì':'‚úó'} | TV Code: ${iP?'‚úì':'‚úó'} | Indy+: ${iL?'‚úì':'‚úó'} | mini-crafts: ${iL?'‚úì':'‚úó'}

JVST SITE MAP:
HOME (https://www.shopjust.store): Hero carousel (JVST √ó Rainn Blais, Noah & Evan, Barrio Sessions, Indy 3 Live) ‚Üí Articles shelf ‚Üí Indy 3 section (Free / Indy+ $0.25 one-time / One $0.50 one-time) ‚Üí Music player (Bad Bunny previews, iTunes API) ‚Üí Culture section (Bad Bunny discography) ‚Üí Collabs (Noah Loke, Evan Duffy, Rainn Blais flip cards) ‚Üí Barrio Sessions (unsigned artist platform) ‚Üí Blade Card section ‚Üí Services (Creative Mode, Voice Mode, Espa√±ol Mode coming soon) ‚Üí Values ‚Üí Instagram caption generator ‚Üí Youth section ‚Üí Pricing ‚Üí Community (LGBTQ+, Hispanic, immigrant) ‚Üí Footer

DASHBOARD (this page): Home panel (welcome, stats, quick access) | Blade Card panel (card visual, 7 color themes: default(grey)/red/gold/blue/green/purple/chrome, display name edit) | Quick Access panel (Tunes, TV, Indy+, mini-crafts, Indy 3 free, JVST Home) | TV Code panel (blurred code, reveal/copy buttons, how-to guide) | Settings panel (photo, nickname, display name) | Membership panel (tier status, upgrade prompts) | Indy chat (that's you)

SERVICES: indy.html (Indy 3 free AI) | https://www.shopjust.store/tunes.html (Blade Card req) | https://www.shopjust.store/tv.html (Blade Card req) | https://www.shopjust.store/indyplus.html (Plus req) | https://www.mini-crafts.com (Plus req)

ACTIVATION: Blade Card = Enter Code modal | Plus = Activate Plus modal | Contact: hello@shopjust.store

If user asks where something is in the dashboard, tell them exactly which panel and button to click. Be specific. If the user asks about a nonexistent feature, politely say you don't have that information and steer them towards existing features. Always encourage them to explore their dashboard and make the most of their membership!`;
};

window.toggleChat = () => {
  const chat = document.getElementById('indy-chat');
  const fab = document.getElementById('indy-fab');
  const open = chat.classList.toggle('open');
  fab.classList.toggle('open', open);
  fab.innerHTML = open ? '‚úï' : 'ü§ñ';
  if (open && chatHist.length === 0) {
    const nick = UP.nickname || CU?.displayName?.split(' ')[0] || 'there';
    addMsg('bot', `Hey ${nick}! I'm Indy ‚Äî your JVST assistant. I know your account and the whole site. What do you need? üëã`);
    setTimeout(() => document.getElementById('chat-input')?.focus(), 80);
  }
};

function addMsg(role, text) {
  const msgs = document.getElementById('chat-msgs');
  const div = document.createElement('div');
  div.className = `chat-msg ${role}`;
  div.innerHTML = `<div class="chat-bubble">${text.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  chatHist.push({ role: role === 'user' ? 'user' : 'assistant', content: text });
}

function addTyping() {
  const msgs = document.getElementById('chat-msgs');
  const div = document.createElement('div');
  div.id = 'typing-ind'; div.className = 'chat-msg bot';
  div.innerHTML = '<div class="chat-typing"><span></span><span></span><span></span></div>';
  msgs.appendChild(div); msgs.scrollTop = msgs.scrollHeight;
}

window.sendChat = async () => {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text) return;
  input.value = ''; input.style.height = '';
  addMsg('user', text);
  const sendBtn = document.getElementById('chat-send');
  sendBtn.disabled = true; addTyping();
  try {
    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method:'POST',
      headers:{ 'Content-Type':'application/json', 'Authorization':`Bearer ${GROQ_KEY}` },
      body: JSON.stringify({
        model: 'llama-3.1-8b-instant',
        messages: [ { role:'system', content:SYSTEM_PROMPT() }, ...chatHist.slice(-14) ],
        max_tokens: 400,
        temperature: 0.75
      })
    });
    const data = await res.json();
    document.getElementById('typing-ind')?.remove();
    const reply = data.choices?.[0]?.message?.content?.trim() || "Couldn't connect to AI. Make sure the Groq API key is set in the script ‚Äî get one free at console.groq.com";
    addMsg('bot', reply);
  } catch {
    document.getElementById('typing-ind')?.remove();
    addMsg('bot', "Can't reach the AI right now. Add your Groq API key to the script to enable Indy.");
  }
  sendBtn.disabled = false;
};

window.chatKeyDown = e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChat(); }
  const el = e.target; el.style.height = ''; el.style.height = Math.min(el.scrollHeight, 80) + 'px';
};

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function setAv(id, photo, fallback) {
  const el = document.getElementById(id); if (!el) return;
  if (photo) el.innerHTML = `<img src="${photo}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
  else { el.textContent = (fallback||'?').charAt(0).toUpperCase(); }
}
function setTxt(id, v) { const el = document.getElementById(id); if (el) el.textContent = v; }
function setTierBadge(id, iP, iL) {
  const el = document.getElementById(id); if (!el) return;
  if (iL) el.innerHTML = '<span class="tier-badge plus">‚≠ê One</span>';
  else if (iP) el.innerHTML = '<span class="tier-badge premium">‚ú® Blade Card</span>';
  else el.innerHTML = '<span class="tier-badge free">Free</span>';
}
function showSave(id) { const el = document.getElementById(id); if (!el) return; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),2400); }
function setBtn(btn, loading) { if (!btn) return; btn.disabled = loading; btn._t = btn._t||btn.textContent; btn.textContent = loading?'Loading‚Ä¶':btn._t; }
function fErr(code) {
  const m = {'auth/email-already-in-use':'That email is already registered. Try signing in.','auth/invalid-email':'Please enter a valid email.','auth/weak-password':'Password needs at least 6 characters.','auth/user-not-found':'No account found with that email.','auth/wrong-password':'Incorrect password.','auth/invalid-credential':'Email or password is incorrect.','auth/too-many-requests':'Too many attempts ‚Äî wait a moment.'};
  return m[code]||'Something went wrong. Please try again.';
}
function readFile(file) { return new Promise((res,rej) => { const r = new FileReader(); r.onload = e=>res(e.target.result); r.onerror=rej; r.readAsDataURL(file); }); }
function toast(msg) {
  const t = document.getElementById('toast'); if (!t) return;
  t.textContent = msg; t.classList.add('show');
  clearTimeout(t._tid); t._tid = setTimeout(()=>t.classList.remove('show'), 3200);
}
function updateNav(loggedIn) {
  const nr = document.getElementById('nav-right'); if (!nr) return;
  nr.innerHTML = loggedIn ? '<button class="nav-btn" onclick="handleSignOut()">Sign Out</button>' : '<button class="nav-btn" onclick="showScreen(\'screen-auth\');switchTab(\'signin\')">Sign In</button><button class="nav-btn primary" onclick="showScreen(\'screen-auth\');switchTab(\'signup\')">Sign Up</button>';
}
</script>

<!-- NON-MODULE GLOBALS -->
<script>
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  if (el) { el.classList.add('active'); window.scrollTo(0,0); }
}
function switchTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.auth-panel').forEach(p => p.classList.remove('active'));
  const te = document.querySelector(`.auth-tab[data-tab="${tab}"]`);
  const pe = document.getElementById(`panel-${tab}`);
  if (te) te.classList.add('active');
  if (pe) pe.classList.add('active');
}
function switchPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sb-item').forEach(i => i.classList.remove('active'));
  const panel = document.getElementById(`panel-${name}`);
  if (panel) panel.classList.add('active');
  const btn = document.querySelector(`.sb-item[data-panel="${name}"]`);
  if (btn) btn.classList.add('active');
  window.scrollTo(0,0);
}
document.getElementById('nav-logo').addEventListener('click', () => {
  const dash = document.getElementById('screen-dashboard');
  if (dash?.classList.contains('active')) switchPanel('home');
  else showScreen('screen-landing');
});
function handlePicChange(e) {
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = ev => {
    const img = document.getElementById('pic-preview');
    const ph = document.getElementById('pic-placeholder');
    img.src = ev.target.result; img.style.display = 'block';
    if (ph) ph.style.display = 'none';
  };
  r.readAsDataURL(f);
}
</script>

</body>
</html>
